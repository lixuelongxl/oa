<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.core136.mapper.bpm.BpmRunLogMapper">
	<resultMap id="BpmRunLog" type="com.core136.bean.bpm.BpmRunLog">
		<id column="ID" property="id" jdbcType="BIGINT" />
		<result column="LOG_ID" property="logId" jdbcType="VARCHAR" />
		<result column="LOG_TYPE" property="logType" jdbcType="VARCHAR" />
		<result column="RUN_ID" property="runId" jdbcType="VARCHAR" />
		<result column="FORM_ID" property="formId" jdbcType="VARCHAR" />
		<result column="FLOW_ID" property="flowId" jdbcType="VARCHAR" />
		<result column="RUN_PROCESS_ID" property="runProcessId" jdbcType="VARCHAR" />
		<result column="REMAK" property="remark" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
		<result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
		<result column="ORG_ID" property="orgId" jdbcType="VARCHAR" />
	</resultMap>
<select id="getRunLogList" resultType="java.util.HashMap">
		SELECT L.LOG_ID AS logId,L.LOG_TYPE AS logType,L.RUN_ID AS runId,L.FORM_ID AS formId,L.FLOW_ID AS flowId, L.RUN_PROCESS_ID AS runProcessId,
		L.REMARK AS remark,L.CREATE_TIME AS createTime,L.CREATE_USER AS createUser,
		(SELECT F.FORM_TITLE FROM BPM_FORM F WHERE F.ORG_ID=L.ORG_ID AND F.FORM_ID=L.FORM_ID) AS formTitle,
		(SELECT A.FLOW_NAME FROM BPM_FLOW A WHERE A.ORG_ID=L.ORG_ID AND A.FLOW_ID=L.FLOW_ID) AS flowName,
		(SELECT B.FLOW_TITLE FROM BPM_LIST B WHERE B.ORG_ID=L.ORG_ID AND B.RUN_ID=L.RUN_ID) AS bpmTitle,
		(SELECT U.USER_NAME FROM USER_INFO U WHERE U.ORG_ID=L.ORG_ID AND U.ACCOUNT_ID=L.CREATE_USER) AS createUserName
		FROM 
		BPM_RUN_LOG L
		WHERE
		L.ORG_ID=#{orgId}
		<if test="runId!=''">
			AND (L.RUN_ID = #{runId} OR L.ID=#{runId})
		</if>
		<if test="createUser!=''.toString() and createUser!=null">
			AND L.CREATE_USER = #{createUser}
		</if>
		<if test="beginTime!=''.toString() and beginTime!=null">
			AND L.CREATE_TIME &gt;=#{beginTime}
		</if>
		<if test="endTime!=''.toString() and endTime!=null">
			AND L.CREATE_TIME &lt;=#{endTime}
		</if>
		<if test="flowId!=''.toString() and flowId!=null">
			AND L.FLOW_ID = #{flowId}
		</if>
		<if test="logType!=''.toString() and logType!=null">
			AND L.LOG_TYPE = #{logType}
		</if>
		<if test="formId!=''.toString() and formId!=null">
			AND L.FORM_ID = #{formId}
		</if>
</select>

</mapper>

