<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.core136.mapper.sys.SmsMapper">
<resultMap id="Sms" type="com.core136.bean.sys.Sms" >
    <id column="ID" property="id" jdbcType="BIGINT" />
    <result column="SMS_ID" property="smsId" jdbcType="VARCHAR" />
    <result column="SMS_TITLE" property="smsTitle" jdbcType="VARCHAR" />
    <result column="SMS_FROM" property="smsForm" jdbcType="VARCHAR" />
    <result column="SMS_TO" property="smsTo" jdbcType="VARCHAR" />
    <result column="SMS_SEND_TIME" property="smsSendTime" jdbcType="VARCHAR" />
    <result column="SMS_CONTENT" property="smsContent" jdbcType="VARCHAR" />
    <result column="MODULE" property="module" jdbcType="VARCHAR" />
    <result column="SMS_URL" property="smsUrl" jdbcType="VARCHAR" />
    <result column="ATTACH" property="attach" jdbcType="VARCHAR" />
    <result column="SMS_STATUS" property="smsStatus" jdbcType="VARCHAR" />
    <result column="ORG_ID" property="orgId" jdbcType="VARCHAR" />
  </resultMap>
<select id="getNoReadSms" resultType="java.util.HashMap">
	SELECT
	S.ID AS id,
	S.SMS_ID AS smsId,
	S.SMS_TITLE AS smsTitle,
	S.SMS_FROM AS smsFrom,
	S.SMS_TO AS smsTo,
	S.SMS_SEND_TIME AS smsSendTime,
	S.SMS_CONTENT AS smsContent,
	S.MODULE AS module,
	S.SMS_URL AS smsUrl,
	S.ATTACH AS attach,
	S.SMS_STATUS AS smsStatus,
	S.ORG_ID AS orgId,
	U.USER_NAME AS userName,
	(SELECT HEAD_IMG FROM ACCOUNT A WHERE A.ACCOUNT_ID = S.SMS_FROM AND A.ORG_ID=S.ORG_ID) AS headImg
FROM
	SMS S,
	USER_INFO U
WHERE
	U.ACCOUNT_ID = S.SMS_FROM
AND U.ORG_ID = S.ORG_ID
AND S.SMS_STATUS='0'
AND S.SMS_TO = #{smsTo}
AND S.ORG_ID = #{orgId}
ORDER BY ID ASC
LIMIT 0,10
</select>




<select id="getMySms" resultType="java.util.HashMap">
	SELECT
	S.ID AS id,
	S.SMS_ID AS smsId,
	S.SMS_TITLE AS smsTitle,
	S.SMS_FROM AS smsFrom,
	S.SMS_TO AS smsTo,
	S.SMS_SEND_TIME AS smsSendTime,
	S.SMS_CONTENT AS smsContent,
	S.MODULE AS module,
	S.SMS_URL AS smsUrl,
	S.ATTACH AS attach,
	S.SMS_STATUS AS smsStatus,
	S.ORG_ID AS orgId,
	U.USER_NAME AS userName,
	(SELECT HEAD_IMG FROM ACCOUNT A WHERE A.ACCOUNT_ID = S.SMS_FROM AND A.ORG_ID=S.ORG_ID) AS headImg
FROM
	SMS S,
	USER_INFO U
WHERE
	U.ACCOUNT_ID = S.SMS_FROM
AND U.ORG_ID = S.ORG_ID
<if test="type =='2'.toString()">
AND S.SMS_TO = #{accountId}
</if>
<if test="type =='1'.toString()">
AND S.SMS_FROM = #{accountId}
</if>
<if test="beginTime!=''.toString() and beginTime!=null">
	AND S.SMS_SEND_TIME &gt;= #{beginTime}
</if>
<if test="endTime!=''.toString() and endTime!=null">
	AND S.SMS_SEND_TIME &lt;=#{endTime}
</if>

AND S.ORG_ID = #{orgId}
<if test="search !='%%' and search !=''.toString() and search!=null">
AND SMS_CONTENT LIKE #{search}
</if>
</select>

<select id="getNoReadSmsCount" resultType="Integer">
SELECT
	COUNT(1)
FROM
	SMS
WHERE
SMS_STATUS='1'
AND SMS_TO = #{smsTo}
AND ORG_ID = #{orgId}
</select>

</mapper>

